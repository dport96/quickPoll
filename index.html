<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickPoll - Real-time Voting with GitHub Storage</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="email-auth-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <h1 class="logo">QuickPoll</h1>
                <nav class="nav">
                    <div id="user-info" class="user-info" style="display: none;">
                        <span class="user-icon">‚úâÔ∏è</span>
                        <span id="user-email"></span>
                        <button id="sign-out-btn" class="btn btn-small btn-secondary">Sign Out</button>
                    </div>
                    <button id="create-poll-btn" class="btn btn-primary">Create Poll</button>
                    <button id="view-results-btn" class="btn btn-secondary">View Results</button>
                    <!-- GitHub indicator will be added here by JavaScript -->
                </nav>
            </div>
        </header>

        <!-- Email Authentication Modal -->
        <div id="email-auth-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üìß Email Authentication Required</h3>
                    <button id="close-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <p>This poll requires email verification to ensure one vote per person.</p>
                    <form id="email-auth-form" novalidate>
                        <div class="form-group">
                            <label for="voter-email">Your Email Address:</label>
                            <input type="email" id="voter-email" name="email" 
                                   placeholder="Enter your email address" 
                                   novalidate>
                        </div>
                        <div class="form-group">
                            <label for="voter-name">Your Name (Optional):</label>
                            <input type="text" id="voter-name" name="name" 
                                   placeholder="Enter your name">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Sign In</button>
                            <button type="button" id="cancel-auth" class="btn btn-secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- GitHub Token Setup Modal -->
        <div id="github-token-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üîó GitHub Access Token Required</h3>
                    <button id="close-token-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="token-setup-intro">
                        <p>To store polls on GitHub Gist, you need to provide a GitHub Personal Access Token.</p>
                        <p><strong>Why is this needed?</strong></p>
                        <ul>
                            <li>üìÅ Stores your polls securely on GitHub</li>
                            <li>üîÑ Enables real-time vote synchronization</li>
                            <li>üåê Allows easy sharing with automatically generated URLs</li>
                            <li>üîí Your polls remain private in your GitHub account</li>
                        </ul>
                    </div>
                    
                    <div class="token-setup-steps">
                        <h4>üìù Quick Setup Steps:</h4>
                        <ol>
                            <li>Go to <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">GitHub Settings ‚Üí Personal Access Tokens</a></li>
                            <li>Choose your token type:
                                <ul>
                                    <li><strong>Classic Token:</strong> Click "Generate new token (classic)" - starts with "ghp_"</li>
                                    <li><strong>Fine-grained Token:</strong> Click "Generate new token (beta)" - starts with "github_pat_"</li>
                                </ul>
                            </li>
                            <li>Give it a name like "<strong>QuickPoll Access</strong>"</li>
                            <li>Select the "<strong>gist</strong>" scope (required for storing polls)</li>
                            <li>Click "<strong>Generate token</strong>" and copy it</li>
                            <li>Paste the token below</li>
                        </ol>
                    </div>

                    <form id="github-token-form">
                        <div class="form-group">
                            <label for="github-token-input">GitHub Personal Access Token:</label>
                            <input type="password" id="github-token-input" name="token" 
                                   placeholder="ghp_... or github_pat_..."
                                   title="GitHub classic tokens start with 'ghp_' or fine-grained tokens start with 'github_pat_'">
                            <small class="form-help">
                                Your token should start with "ghp_" (classic) or "github_pat_" (fine-grained).
                                <button type="button" id="toggle-token-visibility" class="btn-link">üëÅÔ∏è Show/Hide</button>
                            </small>
                        </div>
                        
                        <div class="token-security-note">
                            <p><strong>üîí Security Notes:</strong></p>
                            <ul>
                                <li>Your token is stored securely in your browser session only</li>
                                <li>It's never sent to our servers or stored permanently</li>
                                <li>Only the "gist" permission is needed (minimal access)</li>
                                <li>You can revoke the token anytime on GitHub</li>
                            </ul>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="save-token-btn">
                                <span class="btn-text">Save Token & Continue</span>
                                <span class="btn-loading" style="display: none;">‚è≥ Validating...</span>
                            </button>
                            <button type="button" id="cancel-token-setup" class="btn btn-secondary">Skip for Now</button>
                        </div>
                    </form>

                    <div id="token-validation-result" class="validation-result" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main">
            <!-- Landing Page -->
            <div id="landing-page" class="page active">
                <div class="container">
                    <div class="hero">
                        <h2>Create Real-time Voting Contests</h2>
                        <p>Enable your audience to participate in ranking, rating, and poll voting contests from any device.</p>
                        <div class="storage-info">
                            <p>üîó <strong>GitHub Storage Available:</strong> Enable persistent vote storage using GitHub Gists. 
                            <span id="storage-status">Click the storage indicator above to configure.</span></p>
                        </div>
                        <div class="hero-buttons">
                            <button id="create-ranking-btn" class="btn btn-large btn-primary">Create Ranking Poll</button>
                            <button id="create-rating-btn" class="btn btn-large btn-primary">Create Rating Poll</button>
                            <button id="create-poll-btn-hero" class="btn btn-large btn-primary">Create Simple Poll</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Poll Page -->
            <div id="create-page" class="page">
                <div class="container">
                    <h2>Create Your Poll <span id="create-storage-indicator" class="storage-indicator github">GitHub Gist</span></h2>
                    <form id="poll-form" class="poll-form">
                        <div class="form-group">
                            <label for="poll-title">Poll Title</label>
                            <input type="text" id="poll-title" name="title" required placeholder="Enter poll title">
                        </div>
                        
                        <div class="form-group">
                            <label for="poll-description">Description (Optional)</label>
                            <textarea id="poll-description" name="description" placeholder="Enter poll description"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="poll-type">Poll Type</label>
                            <select id="poll-type" name="type" required>
                                <option value="simple">Simple Poll (Yes/No or Multiple Choice)</option>
                                <option value="rating">Rating Poll (1-5 stars)</option>
                                <option value="ranking">Ranking Poll (Drag to rank)</option>
                            </select>
                        </div>

                        <!-- Authentication Settings -->
                        <div class="form-group">
                            <label for="require-auth">Authentication Settings</label>
                            <div class="auth-options">
                                <label class="radio-option">
                                    <input type="radio" name="auth-mode" value="anonymous" checked>
                                    <span>Anonymous Voting (Multiple votes allowed)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="auth-mode" value="email">
                                    <span>üìß Email Authentication (One vote per email address)</span>
                                </label>
                            </div>
                            <div id="auth-requirement-note" class="help-text" style="display: none; margin-top: 10px;">
                                <div id="auth-signed-in-note" style="display: none;">
                                    <strong>‚úÖ Ready!</strong> You are signed in and can create an authenticated poll. Only you will be able to view the results.
                                </div>
                                <div id="auth-not-signed-in-note" style="display: none;">
                                    <strong>‚ö†Ô∏è Sign In Required:</strong> You must be signed in to create an authenticated poll. 
                                    <button type="button" onclick="app.showEmailAuthModal()" class="btn btn-small btn-primary" style="margin-left: 10px;">Sign In Now</button>
                                </div>
                            </div>
                        </div>

                        <!-- Valid Email Addresses (for authenticated polls) -->
                        <div id="valid-emails-container" class="form-group" style="display: none;">
                            <label for="valid-emails">Valid Email Addresses (Optional)</label>
                            <textarea id="valid-emails" name="validEmails" rows="4" 
                                     placeholder="Enter email addresses (one per line)&#10;user1@example.com&#10;user2@example.com&#10;&#10;Leave empty to allow any email address"></textarea>
                            <small class="help-text">If specified, only these email addresses will be allowed to vote. Leave empty to allow any email.</small>
                        </div>

                        <div id="options-container" class="form-group">
                            <label>Options</label>
                            
                            <!-- Template Options -->
                            <div class="template-options">
                                <label class="template-label">Quick Templates:</label>
                                <div class="template-buttons">
                                    <label class="radio-option template-option">
                                        <input type="radio" name="template" value="custom" checked>
                                        <span>Custom Options</span>
                                    </label>
                                    <label class="radio-option template-option">
                                        <input type="radio" name="template" value="yes-no">
                                        <span>Yes / No</span>
                                    </label>
                                    <label class="radio-option template-option">
                                        <input type="radio" name="template" value="approve-disapprove">
                                        <span>Approve / Disapprove / Abstain</span>
                                    </label>
                                    <label class="radio-option template-option">
                                        <input type="radio" name="template" value="agree-disagree">
                                        <span>Agree / Disagree / Neutral</span>
                                    </label>
                                    <label class="radio-option template-option">
                                        <input type="radio" name="template" value="satisfaction">
                                        <span>Very Satisfied / Satisfied / Neutral / Dissatisfied / Very Dissatisfied</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="options-list">
                                <div class="option-input">
                                    <input type="text" name="option" placeholder="Option 1" required>
                                    <button type="button" class="btn btn-small btn-danger remove-option">Remove</button>
                                </div>
                                <div class="option-input">
                                    <input type="text" name="option" placeholder="Option 2" required>
                                    <button type="button" class="btn btn-small btn-danger remove-option">Remove</button>
                                </div>
                            </div>
                            <button type="button" id="add-option-btn" class="btn btn-small btn-secondary">Add Option</button>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="back-to-home" class="btn btn-secondary">Back</button>
                            <button type="submit" class="btn btn-primary">Create Poll</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Vote Page -->
            <div id="vote-page" class="page">
                <div class="container">
                    <div id="vote-content">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Results Page -->
            <div id="results-page" class="page">
                <div class="container">
                    <div id="results-content">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Poll Created Page -->
            <div id="poll-created-page" class="page">
                <div class="container">
                    <div class="success-message">
                        <h2>Poll Created Successfully!</h2>
                        <div class="poll-id-display">
                            <label>Poll ID:</label>
                            <span id="poll-id-value" class="poll-id"></span>
                        </div>
                        
                        <!-- GitHub Gist Info -->
                        <div id="gist-info" class="gist-info" style="display: none;">
                            <h4>üîó Stored on GitHub</h4>
                            <p>This poll is stored as a private GitHub Gist: <a id="gist-link" href="#" target="_blank" class="gist-link">View Gist</a></p>
                        </div>
                        
                        <p>Share these links with your audience:</p>
                        <div class="link-container">
                            <div class="link-group">
                                <label>Voting Link:</label>
                                <div class="link-display">
                                    <input type="text" id="voting-link" readonly>
                                    <button id="copy-voting-link" class="btn btn-small btn-secondary">Copy</button>
                                </div>
                            </div>
                            <div class="link-group">
                                <label>Results Link:</label>
                                <div class="link-display">
                                    <input type="text" id="results-link" readonly>
                                    <button id="copy-results-link" class="btn btn-small btn-secondary">Copy</button>
                                </div>
                            </div>
                        </div>
                        <div id="auth-info" class="auth-info" style="display: none;">
                            <div class="info-box">
                                <h4>üìß Email Authentication Enabled</h4>
                                <p>Voters will need to provide their email address to participate. This ensures:</p>
                                <ul>
                                    <li>One vote per email address</li>
                                    <li>Verified voter participation</li>
                                    <li>Prevention of duplicate voting</li>
                                    <li id="email-restriction-info" style="display: none;">Only specified email addresses can vote</li>
                                </ul>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="view-results-now" class="btn btn-primary">View Results</button>
                            <button id="create-another-poll" class="btn btn-secondary">Create Another Poll</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2025 QuickPoll. Real-time voting made simple and secure.</p>
                <p><small>All poll data is securely stored using GitHub Gists for persistent, real-time vote sharing.</small></p>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="email-auth-script.js"></script>
    <script src="github-gist-script.js"></script>
    <script src="gist-storage-test.js"></script>
</body>
</html>
